<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resume Screening System</title>
    <link rel="stylesheet" href="style.css">
</head>
  
<body>
    <header class="header">
        <h1>AI Resume Screening</h1>
        <li class="nav">
            <a href="index.html">Home</a>
            <a href="login.html">Sign In</a>
        </li>
    </header>
    <div class="container">

        <div class="front-pic">
            <div class="front-pic-text">
                <h1>AI Resume Screening</h1>
            <p>
                Our AI-powered resume screening system simplifies the hiring process by automatically reviewing and evaluating resumes. 
                By using advanced algorithms, the system analyzes resumes for key information like skills, experience, and qualifications, 
                comparing them to job requirements. This allows recruiters to quickly identify the most suitable candidates, 
                streamlining the hiring process while ensuring a fair and unbiased evaluation. With this tool, you'll save time, 
                improve efficiency, and make smarter hiring decisions.
            </p>
            <a href="#upload-section1" class="btn-link">
                <button class="btn">Upload resume</button>
            </a>
            </div>
            <img src="pic/438-30.png" alt="Resume Screening System" class="front-pic-img">
        </div>
        <div class="upload-section" id="description-section">
            <h2>Job Description</h2>
            <textarea id="jobDescription" placeholder="Paste job description here..."></textarea>
        </div>
        <div class="upload-section" id="upload-section1">
            <input type="file" style="display: none;" accept=".pdf,.docx,.txt" id="fileInput">
            <p>Drop PDF, DOCX, or TXT files here</p>
            <p>or</p>
            <button class="btn" style="margin: auto;" onclick="document.getElementById('fileInput').click()">Upload your resume</button>
        </div>

        <div class="analytics-dashboard">
            <div class="metric-card">
                <div class="metric-value" id="totalResumes">0</div>
                <div class="metric-label">Total Resumes</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="avgExperience">0</div>
                <div class="metric-label">Avg. Experience (yrs)</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="matchRate">0%</div>
                <div class="metric-label">Match Rate</div>
            </div>
        </div>

        <div class="resume-list" id="resumeList">
            <!-- Resume cards will be populated here -->
        </div> 

    </div>

    <script>
        let resumes = [];
        let jobDescription = '';

        document.getElementById('jobDescription').addEventListener('input', function(e) {
            jobDescription = e.target.value;
        });

        // In handleFileUpload function, update the fetch call:
const handleFileUpload = (file) => {
    if (!jobDescription) {
        alert('Please enter a job description first');
        return;
    }

    const formData = new FormData();
    formData.append('resume', file);
    formData.append('jobDesc', jobDescription);

    fetch('http://localhost:3001/upload', {
        method: 'POST',
        body: formData,
    })
    .then(response => {
        if (!response.ok) throw new Error('Server error');
        return response.json();
    })
    .then(data => {
        const resumeData = {
            name: file.name,
            category: data.category,
            similarity: data.similarity_score,
            keywords: data.key_roles,
            experience: data.experience
        };
        
        resumes.push(resumeData);
        updateAnalytics();
        addResumeCard(resumeData);
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error processing resume: ' + error.message);
    });
};

        function updateAnalytics() {
            // Update total resumes
            document.getElementById('totalResumes').textContent = resumes.length;

            // Update average experience
            const totalExp = resumes.reduce((sum, r) => sum + r.experience, 0);
            document.getElementById('avgExperience').textContent = 
                (totalExp / resumes.length).toFixed(1);

            // Update match rate (assuming >70% similarity is a match)
            const matches = resumes.filter(r => r.similarity >= 70).length;
            document.getElementById('matchRate').textContent = 
                `${((matches / resumes.length) * 100).toFixed(0)}%`;
        }

        function addResumeCard(resume) {
            const card = document.createElement('div');
            card.className = 'resume-card';
            card.innerHTML = `
                <div class="resume-meta">
                    <div>
                        <h4>${resume.name}</h4>
                        <div class="category-tag">${resume.category}</div>
                    </div>
                    <div class="similarity">
                        <div class="similarity-bar">
                            <div class="similarity-fill" 
                                 style="width: ${resume.similarity}%"></div>
                        </div>
                        <span>${Math.round(resume.similarity)}% Match</span>
                    </div>
                </div>
                <div class="keywords">
                    ${resume.keywords.map(k => `<span class="keyword">${k}</span>`).join('')}
                </div>
                <div style="margin-top: 1rem;">
                    Experience: ${resume.experience} years
                </div>
            `;

            document.getElementById('resumeList').appendChild(card);
        }

        // Existing event listeners and helper functions
        const handleFileDrop = (event) => {
            event.preventDefault();
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                Array.from(files).forEach(handleFileUpload);
            }
        };

        const handleFileSelect = (event) => {
            Array.from(event.target.files).forEach(handleFileUpload);
        };

        const dropArea = document.querySelector('.upload-section');
        dropArea.addEventListener('dragover', (event) => event.preventDefault());
        dropArea.addEventListener('drop', handleFileDrop);

        document.getElementById('fileInput').addEventListener('change', handleFileSelect);
    </script>
</body>
</html>
